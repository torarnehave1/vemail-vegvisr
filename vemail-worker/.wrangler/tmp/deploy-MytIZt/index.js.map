{
  "version": 3,
  "sources": ["../../../index.js"],
  "sourceRoot": "/Users/torarnehave/Documents/GitHub/vemail-vegvisr/vemail-worker/.wrangler/tmp/deploy-MytIZt",
  "sourcesContent": ["/**\n * vemail-worker \u2014 BFF for vemail-vegvisr\n *\n * Proxies email-account requests to email-worker via service binding.\n * The browser never talks to cookie.vegvisr.org directly for account operations.\n */\n\nfunction corsHeaders(response) {\n  response.headers.set('Access-Control-Allow-Origin', '*')\n  response.headers.set('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS')\n  response.headers.set('Access-Control-Allow-Headers', 'Content-Type')\n  response.headers.set('Access-Control-Max-Age', '86400')\n  return response\n}\n\nexport default {\n  async fetch(request, env) {\n    const url = new URL(request.url)\n    const path = url.pathname\n    const method = request.method\n\n    if (method === 'OPTIONS') {\n      return corsHeaders(new Response(null, { status: 204 }))\n    }\n\n    // Health check\n    if (path === '/health') {\n      return corsHeaders(\n        new Response(JSON.stringify({ ok: true, worker: 'vemail-worker' }), {\n          headers: { 'Content-Type': 'application/json' },\n        }),\n      )\n    }\n\n    // --- Proxy to email-worker via service binding ---\n    if (path.startsWith('/email-accounts') || path === '/send-gmail-email') {\n      const targetUrl = new URL(request.url)\n      // Rewrite host so the email-worker sees the correct path\n      targetUrl.hostname = 'email-worker.internal'\n\n      const workerResponse = await env.EMAIL_WORKER.fetch(\n        new Request(targetUrl.toString(), {\n          method,\n          headers: request.headers,\n          body: method !== 'GET' && method !== 'HEAD' ? request.body : undefined,\n        }),\n      )\n\n      // Clone response so we can add CORS headers\n      const response = new Response(workerResponse.body, {\n        status: workerResponse.status,\n        headers: workerResponse.headers,\n      })\n      return corsHeaders(response)\n    }\n\n    return corsHeaders(\n      new Response(JSON.stringify({ error: 'Not found' }), {\n        status: 404,\n        headers: { 'Content-Type': 'application/json' },\n      }),\n    )\n  },\n}\n"],
  "mappings": ";;;;AAOA,SAAS,YAAY,UAAU;AAC7B,WAAS,QAAQ,IAAI,+BAA+B,GAAG;AACvD,WAAS,QAAQ,IAAI,gCAAgC,iCAAiC;AACtF,WAAS,QAAQ,IAAI,gCAAgC,cAAc;AACnE,WAAS,QAAQ,IAAI,0BAA0B,OAAO;AACtD,SAAO;AACT;AANS;AAQT,IAAO,gBAAQ;AAAA,EACb,MAAM,MAAM,SAAS,KAAK;AACxB,UAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAC/B,UAAM,OAAO,IAAI;AACjB,UAAM,SAAS,QAAQ;AAEvB,QAAI,WAAW,WAAW;AACxB,aAAO,YAAY,IAAI,SAAS,MAAM,EAAE,QAAQ,IAAI,CAAC,CAAC;AAAA,IACxD;AAGA,QAAI,SAAS,WAAW;AACtB,aAAO;AAAA,QACL,IAAI,SAAS,KAAK,UAAU,EAAE,IAAI,MAAM,QAAQ,gBAAgB,CAAC,GAAG;AAAA,UAClE,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,QAChD,CAAC;AAAA,MACH;AAAA,IACF;AAGA,QAAI,KAAK,WAAW,iBAAiB,KAAK,SAAS,qBAAqB;AACtE,YAAM,YAAY,IAAI,IAAI,QAAQ,GAAG;AAErC,gBAAU,WAAW;AAErB,YAAM,iBAAiB,MAAM,IAAI,aAAa;AAAA,QAC5C,IAAI,QAAQ,UAAU,SAAS,GAAG;AAAA,UAChC;AAAA,UACA,SAAS,QAAQ;AAAA,UACjB,MAAM,WAAW,SAAS,WAAW,SAAS,QAAQ,OAAO;AAAA,QAC/D,CAAC;AAAA,MACH;AAGA,YAAM,WAAW,IAAI,SAAS,eAAe,MAAM;AAAA,QACjD,QAAQ,eAAe;AAAA,QACvB,SAAS,eAAe;AAAA,MAC1B,CAAC;AACD,aAAO,YAAY,QAAQ;AAAA,IAC7B;AAEA,WAAO;AAAA,MACL,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,YAAY,CAAC,GAAG;AAAA,QACnD,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC;AAAA,IACH;AAAA,EACF;AACF;",
  "names": []
}
